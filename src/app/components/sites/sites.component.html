<div class="sites-container">
  <!-- Header -->
  <div class="sites-header">
    <h1 class="md3-headline-large">Sites</h1>
    <button mat-icon-button class="add-site-btn">
      <mat-icon>add_circle</mat-icon>
    </button>
  </div>

  <!-- Filter Chips Section -->
  <div class="filter-section">
    <!-- Site & Interfaces Card (left section) -->
    <div class="sites-interfaces-card">
      <mat-icon>device_hub</mat-icon>
      <div class="card-content">
        <span class="card-label">Site & Interfaces</span>
        <div class="interface-badge">
          ESRI-VANC - External, 1050 ...
        </div>
      </div>
      <button mat-icon-button>
        <mat-icon>add</mat-icon>
      </button>
    </div>

    <!-- Filter Chips -->
    <div class="filter-chips-container">
      <div class="filter-chips">
        <mat-chip-list>
          <mat-chip *ngFor="let filter of activeFilters"
                    [style.background-color]="filter.color"
                    [style.color]="'white'"
                    [removable]="true"
                    (removed)="removeFilter(filter)">
            {{ filter.label }}
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>
        </mat-chip-list>
      </div>

      <!-- Search and Download -->
      <div class="search-actions">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Filter</mat-label>
          <input matInput
                 #searchInput
                 [(ngModel)]="searchText"
                 (keyup)="applyFilter($event)"
                 placeholder="Search sites...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
        <button mat-icon-button class="download-btn">
          <mat-icon>download</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Sites Table -->
  <div class="table-container">
    <table mat-table [dataSource]="dataSource" matSort class="sites-table">
      <!-- Site Alias Column -->
      <ng-container matColumnDef="alias">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Site Alias</th>
        <td mat-cell *matCellDef="let site">
          <div class="alias-cell">
            <span class="alias-text">{{ site.alias }}</span>
            <button mat-icon-button class="edit-icon">
              <mat-icon>edit</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <!-- Address Column -->
      <ng-container matColumnDef="address">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          Address
          <mat-icon class="sort-icon">arrow_upward</mat-icon>
        </th>
        <td mat-cell *matCellDef="let site">{{ site.address }}</td>
      </ng-container>

      <!-- Contacts Column -->
      <ng-container matColumnDef="contacts">
        <th mat-header-cell *matHeaderCellDef>Contacts</th>
        <td mat-cell *matCellDef="let site">
          <button mat-icon-button color="primary" (click)="viewContacts(site)">
            <mat-icon>groups</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Circuits Health Column -->
      <ng-container matColumnDef="circuitHealth">
        <th mat-header-cell *matHeaderCellDef>Circuits Health</th>
        <td mat-cell *matCellDef="let site">
          <div class="health-indicators" *ngIf="site.circuitHealth !== 'none'">
            <mat-icon *ngIf="site.circuitHealth === 'up'" class="health-up">circle</mat-icon>
            <mat-icon *ngIf="site.circuitHealth === 'up'" class="health-up">circle</mat-icon>
            <mat-icon *ngIf="site.circuitHealth === 'up'" class="health-up">circle</mat-icon>
            <mat-icon *ngIf="site.circuitHealth === 'disabled'" class="health-disabled">circle</mat-icon>
          </div>
          <span *ngIf="site.circuitHealth === 'none'">–</span>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let site">
          <button mat-icon-button color="primary" (click)="openExternal(site)">
            <mat-icon>open_in_new</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <!-- Legend and Pagination -->
  <div class="table-footer">
    <div class="legend">
      <span class="legend-label">Key:</span>
      <div class="legend-item">
        <mat-icon class="health-up">arrow_upward</mat-icon>
        <span>Up</span>
      </div>
      <div class="legend-item">
        <mat-icon class="health-down">arrow_downward</mat-icon>
        <span>Down</span>
      </div>
      <div class="legend-item">
        <mat-icon class="health-pending">circle</mat-icon>
        <span>Pending Disconnect</span>
      </div>
      <div class="legend-item">
        <mat-icon class="health-disabled">circle</mat-icon>
        <span>Monitoring Disabled</span>
      </div>
      <div class="legend-item">
        <span>– No Data</span>
      </div>
    </div>

    <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]"
                   [pageSize]="10"
                   showFirstLastButtons
                   aria-label="Select page of sites">
    </mat-paginator>
  </div>
</div>
